<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>منظمة ليالي العرب | السينما المفتوحة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;900&display=swap');
        body { background: #050505; color: white; font-family: 'Cairo', sans-serif; }
        .gold-text { color: #d4af37; }
        .movie-card { background: #111; border-radius: 10px; overflow: hidden; transition: 0.3s; cursor: pointer; border: 1px solid #222; }
        .movie-card:hover { transform: scale(1.05); border-color: #d4af37; }
        #player-overlay { position: fixed; inset: 0; background: black; z-index: 9999; display: none; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div id="player-overlay">
        <button onclick="closePlayer()" class="absolute top-5 left-5 bg-yellow-600 text-black px-6 py-2 rounded-full font-bold z-[10001]">إغلاق ×</button>
        <div id="videoContainer" class="w-full h-full"></div>
    </div>

    <header class="p-6 bg-black border-b border-yellow-600/20 flex justify-between items-center sticky top-0 z-50">
        <h1 class="text-2xl font-black gold-text">ليالي العرب <span class="text-white text-xs">V.FINAL</span></h1>
        <div class="flex gap-2">
            <input type="text" id="searchInput" placeholder="اكتب اسم الفيلم بالإنجليزية..." class="bg-zinc-900 border border-zinc-800 p-2 rounded-lg text-sm w-64 outline-none focus:border-yellow-600">
            <button onclick="searchMovies()" class="bg-yellow-600 text-black px-4 py-2 rounded-lg font-bold text-sm">بحث</button>
        </div>
    </header>

    <main class="p-8">
        <div class="mb-10 p-6 bg-yellow-600/10 border border-yellow-600/20 rounded-2xl flex justify-between items-center">
            <div>
                <h2 class="text-xl font-bold">مرحباً بك في ديوان المنظمة</h2>
                <p class="text-xs text-gray-400">إذا لم تظهر الأفلام، اضغط على زر "تنشيط الجلب"</p>
            </div>
            <button onclick="fetchMovies()" class="bg-yellow-600 text-black px-6 py-2 rounded-full font-bold animate-bounce">تنشيط الجلب ⚡</button>
        </div>

        <div id="movieGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
            </div>
    </main>

    <script>
        // مفتاح احتياطي فعال جداً
        const API_KEY = '8d6d9194546435662aa063955619f697';
        
        async function fetchMovies() {
            const grid = document.getElementById('movieGrid');
            grid.innerHTML = '<div class="col-span-full text-center py-10">جاري سحب الأفلام من الخزنة...</div>';
            
            try {
                // جلب الأفلام الشائعة
                const resp = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=ar-SA&page=1`);
                const data = await resp.json();
                render(data.results);
            } catch (e) {
                grid.innerHTML = '<div class="col-span-full text-center text-red-500">حدث خطأ في الشبكة. جرب استخدام VPN أو متصفح آخر.</div>';
            }
        }

        async function searchMovies() {
            const query = document.getElementById('searchInput').value;
            if(!query) return;
            const resp = await fetch(`https://api.themoviedb.org/3/search/movie?api_key=${API_KEY}&query=${query}&language=ar-SA`);
            const data = await resp.json();
            render(data.results);
        }

        function render(movies) {
            const grid = document.getElementById('movieGrid');
            grid.innerHTML = '';
            movies.forEach(m => {
                if(!m.poster_path) return;
                const card = document.createElement('div');
                card.className = 'movie-card';
                card.innerHTML = `
                    <img src="https://image.tmdb.org/t/p/w500${m.poster_path}" class="w-full h-64 object-cover">
                    <div class="p-3">
                        <p class="text-xs font-bold truncate">${m.title}</p>
                        <p class="text-[10px] text-yellow-600 mt-1">★ ${m.vote_average}</p>
                    </div>
                `;
                card.onclick = () => openPlayer(m.id);
                grid.appendChild(card);
            });
        }

        function openPlayer(id) {
            const overlay = document.getElementById('player-overlay');
            const container = document.getElementById('videoContainer');
            // السيرفر الأكثر استقراراً في العالم حالياً
            const url = `https://vidsrc.me/embed/movie?tmdb=${id}`;
            
            overlay.style.display = 'block';
            container.innerHTML = `<iframe src="${url}" allowfullscreen></iframe>`;
        }

        function closePlayer() {
            document.getElementById('player-overlay').style.display = 'none';
            document.getElementById('videoContainer').innerHTML = '';
        }

        // تشغيل تلقائي
        fetchMovies();
    </script>
</body>
</html>
